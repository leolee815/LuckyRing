var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){var e=new egret.Sprite;e.graphics.beginFill(13699343),e.graphics.drawRect(0,0,550,1e3),e.graphics.endFill(),this.addChild(e);var t=new egret.Bitmap;t.texture=RES.getRes("load"),t.width=100,t.height=100,t.x=480,t.y=100,e.addChild(t),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){var i=parseInt(String(e/t*100));this.textField.text=i+"%"},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/data.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload"),RES.loadGroup("soundload",1)},s.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(e){console.warn("Resourse has failed to load")},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.createGameScene=function(){var e=new egret.Sound;e=RES.getRes("sound"),e.type=egret.Sound.MUSIC,this.bgChannel=e.play(0,0);var t=new egret.Sprite;t.graphics.beginFill(13699343),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),this.addChild(t);var t=new egret.Sprite;t.graphics.beginFill(13699343),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),this.addChild(t);var i=this.createBitmapByName("yRound");i.width=110,i.height=110,this.addChild(i),i.anchorOffsetX=65,i.anchorOffsetY=65,i.x=120,i.y=110,egret.Tween.get(i,{loop:!0}).to({scaleX:.9,scaleY:.9},1e3).to({scaleX:1,scaleY:1},1e3);var s=this.createBitmapByName("yRound");s.width=100,s.height=100,this.addChild(s),s.anchorOffsetX=65,s.anchorOffsetY=65,s.x=185,s.y=80,egret.Tween.get(s,{loop:!0}).to({scaleX:1,scaleY:1},100).to({scaleX:1.1,scaleY:1.1},1500).to({scaleX:1,scaleY:1},1e3);var a=this.createBitmapByName("yRound");a.width=130,a.height=130,this.addChild(a),a.anchorOffsetX=65,a.anchorOffsetY=65,a.x=this.stage.stageWidth-65,a.y=0,egret.Tween.get(a,{loop:!0}).to({scaleX:1,scaleY:1},100).to({scaleX:1.1,scaleY:1.1},1e3).to({scaleX:1,scaleY:1},1e3);var h=this.createBitmapByName("yRound");h.width=130,h.height=130,this.addChild(h),h.anchorOffsetX=65,h.anchorOffsetY=65,h.x=-35,h.y=265,egret.Tween.get(h,{loop:!0}).to({scaleX:.9,scaleY:.9},1e3).to({scaleX:1,scaleY:1},1e3);var n=this.createBitmapByName("yRound1");n.width=80,n.height=100,this.addChild(n),n.anchorOffsetX=40,n.anchorOffsetY=50,n.x=this.stage.stageWidth-20,n.y=120,egret.Tween.get(n,{loop:!0}).to({scaleX:.9,scaleY:.9},1500).to({scaleX:1,scaleY:1},1e3);var r=this.createBitmapByName("yRound");r.width=130,r.height=130,this.addChild(r),egret.Tween.get(r,{loop:!0}).to({scaleX:1,scaleY:1},100).to({scaleX:1.1,scaleY:1.1},1e3).to({scaleX:1,scaleY:1},1e3),r.anchorOffsetX=65,r.anchorOffsetY=65,r.x=-15,r.y=515;var o=this.createBitmapByName("yRound");o.width=130,o.height=130,this.addChild(o),egret.Tween.get(o,{loop:!0}).to({scaleX:.9,scaleY:.9},1e3).to({scaleX:1,scaleY:1},1e3),o.anchorOffsetX=65,o.anchorOffsetY=65,o.x=40,o.y=600;var d=this.createBitmapByName("yRound");d.width=130,d.height=130,this.addChild(d),d.anchorOffsetX=65,d.anchorOffsetY=65,d.x=this.stage.stageWidth+20,d.y=585,egret.Tween.get(d,{loop:!0}).to({scaleX:.9,scaleY:.9},2e3).to({scaleX:1,scaleY:1},1e3);var g=this.createBitmapByName("yRound3");g.width=115,g.height=95,this.addChild(g),g.anchorOffsetX=65,g.anchorOffsetY=65,g.x=this.stage.stageWidth-40,g.y=this.stage.stageHeight-20,egret.Tween.get(g,{loop:!0}).to({scaleX:.9,scaleY:.9},1e3).to({scaleX:1,scaleY:1},1e3),egret.localStorage.getItem("money")?this.loadGameEndView():(this.preView=new GamePreView,this.addChild(this.preView),this.preView.enterGame.touchEnabled=!0,this.preView.enterGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.loadIntroduceView,this)),this.WxShare=new WxShare,this.addChild(this.WxShare)},s.loadIntroduceView=function(){this.removeChild(this.preView),this.gameIntroduceView=new GameIntroductionView,this.addChild(this.gameIntroduceView),this.gameIntroduceView.startGame.touchEnabled=!0,this.gameIntroduceView.startGame.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.removeChild(this.gameIntroduceView),this.loadGameView()},this)},s.loadGameView=function(){this.gameView=new GameView,this.addChild(this.gameView),this.hittestEvent()},s.loadGameEndView=function(){this.gameEndView=new GameEndView,this.addChild(this.gameEndView),this.gameEndView.ruleBtn.touchEnabled=!0,this.gameEndView.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.loadGameRuleView,this),this.gameEndView.replayBtn.touchEnabled=!0,this.gameEndView.replayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){egret.localStorage.setItem("times","0"),this.gameEndView.gameDiv.removeChild(this.gameEndView.myImg),this.removeChild(this.gameEndView),this.loadGameView()},this)},s.loadGameRuleView=function(){this.gameEndView.gameDiv.removeChild(this.gameEndView.myImg),this.gameRuleView=new GameRuleView,this.removeChild(this.gameEndView),this.addChild(this.gameRuleView),this.gameRuleView.closeContain.touchEnabled=!0,this.gameRuleView.closeContain.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.removeChild(this.gameRuleView),this.loadGameEndView()},this)},s.hittestEvent=function(){var e=new egret.Shape;e.graphics.beginFill(0),e.alpha=0,e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),this.gameView.addChild(e),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.hitTestP(this.gameView.shp,this.gameView.shp1),t=parseInt(egret.localStorage.getItem("times"));if(e){this.gameView.speed+=.4,this.gameView.removeChild(this.gameView.shp),this.gameView.removeChild(this.gameView.co),this.gameView.createCo();var i=Number(String(5e3*Math.random()).split(".")[0]),s=t+1;if(egret.Tween.get(this.gameView.addOne).to({alpha:1},500).to({alpha:0},500),egret.localStorage.setItem("times",String(s)),3>=s&&s>0)egret.localStorage.setItem("money","100"),egret.localStorage.setItem("conum","100000");else if(s>3&&6>=s)egret.localStorage.setItem("money","200"),egret.localStorage.setItem("conum","200000");else if(s>6)return egret.localStorage.setItem("money","300"),egret.localStorage.setItem("conum","300000"),this.gameView.monkeyRing.removeEventListener(egret.Event.ENTER_FRAME,this.gameView.enterFrameHandle,this.gameView),egret.Tween.get(this.gameView).to({x:5},100,egret.Ease.circIn).to({x:-8},100,egret.Ease.circIn).to({x:0},100,egret.Ease.circIn).call(function(){this.removeChild(this.gameView),this.loadGameEndView()}.bind(this)),void egret.localStorage.setItem("copon","YVX"+String(Number(egret.localStorage.getItem("conum"))+i));this.gameView.textMoney.text="¥"+egret.localStorage.getItem("money"),egret.localStorage.setItem("copon","YVX"+String(Number(egret.localStorage.getItem("conum"))+i))}else t>0&&3>=t?egret.localStorage.setItem("money","100"):t>3&&6>=t?egret.localStorage.setItem("money","200"):t>6&&egret.localStorage.setItem("money","300"),this.gameView.monkeyRing.removeEventListener(egret.Event.ENTER_FRAME,this.gameView.enterFrameHandle,this.gameView),egret.Tween.get(this.gameView).to({x:5},100,egret.Ease.circIn).to({x:-8},100,egret.Ease.circIn).to({x:0},100,egret.Ease.circIn).call(function(){this.removeChild(this.gameView),this.loadGameEndView()}.bind(this))},this)},s.hitTest=function(e,t){var i=e.getBounds(),s=t.getBounds();return i.x=e.x,i.y=e.y,s.x=t.x,s.y=t.y,i.intersects(s)},s.hitTestP=function(e,t){var i=this.gameView.creatept2();return e.hitTestPoint(i.x,i.y)},s.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var GameEndView=function(e){function t(){e.call(this),this.texttop=new egret.TextField,this.textMon=new egret.TextField,this.textMiddle=new egret.TextField,this.textMiddle1=new egret.TextField,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){var t=new egret.Bitmap;t.texture=RES.getRes("gameEndView"),t.width=220,t.height=300,t.x=this.stage.stageWidth/2-t.width/2,t.y=100,this.addChild(t);var i=document.getElementById("gameDiv"),s=135,a=135,h=Math.floor(s/this.stage.stageWidth*100),n=Math.floor(a/this.stage.stageHeight*100);this.gameDiv=document.getElementById("gameDiv"),this.myImg=document.createElement("img"),this.myImg.id="img_code",this.myImg.src="resource/assets/qrCode.png",this.myImg.style.width=h+"%",this.myImg.style.height=n+"%",this.myImg.style.position="absolute",this.myImg.style.left=50-h/2+"%",this.myImg.style.top=100-n-n/3*2+"%",i.appendChild(this.myImg),this.textMon.text=egret.localStorage.getItem("money"),this.textMon.size=25,this.textMon.border=!0,this.textMon.textColor=16777215,this.textMon.fontFamily="黑体",this.textMon.x=this.stage.stageWidth/2+12,this.textMon.y=142,this.texttop.text="恭喜您!获得"+this.textMon.text+"元红包",this.texttop.size=25,this.texttop.textColor=16777215,this.texttop.fontFamily="黑体",this.texttop.x=this.stage.stageWidth/2-this.texttop.width/2,this.texttop.y=140,this.addChild(this.texttop),this.textMiddle.text=egret.localStorage.getItem("money")+"元",this.textMiddle.size=29,this.textMiddle.bold=!0,this.textMiddle.textColor=16645136,this.textMiddle.fontFamily="黑体",this.textMiddle.x=this.stage.stageWidth/2-this.textMiddle.width/2,this.textMiddle.y=270,this.addChild(this.textMiddle),"0"==egret.localStorage.getItem("money")?this.textMiddle1.text="":this.textMiddle1.text=egret.localStorage.getItem("copon"),this.textMiddle1.size=17,this.textMiddle1.textColor=16645136,this.textMiddle1.fontFamily="黑体",this.textMiddle1.x=this.stage.stageWidth/2-this.textMiddle1.width/2,this.textMiddle1.y=300,this.addChild(this.textMiddle1),this.ruleBtn=this.createBtn(75,430,150,40,"红包使用规则",15),this.replayBtn=this.createBtn(260,430,150,40,"再玩一次",35),this.shareBtn=this.createBtn(195,480,85,40,"分享",23),this.followBtn=this.createBtn(95,this.stage.stageHeight-70,290,40,"关注公众号查看店铺位置兑奖",15),this.shareView=new egret.Bitmap,this.shareView.texture=RES.getRes("shareView"),this.shareView.width=this.stage.stageWidth,this.shareView.height=this.stage.stageHeight,this.shareView.touchEnabled=!0,this.shareView.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.removeChild(this.shareView)},this),this.shareBtn.touchEnabled=!0,this.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.addChild(this.shareView)},this),this.followBtn.touchEnabled=!0,this.followBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){window.open("http://mp.weixin.qq.com/s?__biz=MjM5NDE4NjA3Mg==&mid=201308273&idx=1&sn=2e2ac414cc9acceea8cfe38f7c1bb978&scene=1&srcid=0129xIsodLI51QbUO67Toysu&from=singlemessage&isappinstalled=0#wechat_redirect")},this)},s.createBtn=function(e,t,i,s,a,h){var n=h||15,r=new egret.Sprite;r.graphics.beginFill(16777215),r.graphics.drawRoundRect(e,t,i,s,15,15),r.graphics.endFill(),this.addChild(r);var o=new egret.TextField;return o.text=a,o.textColor=13631488,o.size=20,o.backgroundColor=0,o.x=e+n,o.y=t+10,o.fontFamily="黑体",r.addChild(o),r},t}(egret.Sprite);egret.registerClass(GameEndView,"GameEndView");var GameIntroductionView=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);var t=new egret.Bitmap;t.texture=RES.getRes("introduce"),t.width=400,t.height=400,t.x=this.stage.stageWidth/2-t.width/2,t.y=this.stage.stageHeight/2-t.height/2-80,this.addChild(t),this.startGame=new egret.Bitmap,this.startGame.texture=RES.getRes("startgame"),this.startGame.width=142,this.startGame.height=84,this.startGame.x=this.stage.stageWidth/2-this.startGame.width/2,this.startGame.y=this.stage.stageHeight/2-this.startGame.height/2+230,this.addChild(this.startGame)},t}(egret.Sprite);egret.registerClass(GameIntroductionView,"GameIntroductionView");var GamePreView=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);var t=new egret.Bitmap;t.texture=RES.getRes("preview"),t.width=260,t.height=400,t.x=this.stage.stageWidth/2-t.width/2,t.y=this.stage.stageHeight/2-t.height/2,this.addChild(t),this.enterGame=new egret.Bitmap,this.enterGame.texture=RES.getRes("enterGame"),this.enterGame.width=142,this.enterGame.height=84,this.enterGame.x=this.stage.stageWidth/2-this.enterGame.width/2,this.enterGame.y=this.stage.stageHeight/2-this.enterGame.height/2+80,this.addChild(this.enterGame)},t}(egret.Sprite);egret.registerClass(GamePreView,"GamePreView");var GameRuleView=function(e){function t(){e.call(this),this.closeContain=new egret.Shape,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this);var t=new egret.Bitmap;t.texture=RES.getRes("gameRuleView"),t.width=450,t.height=350,t.x=this.stage.stageWidth/2-t.width/2,t.y=this.stage.stageHeight/2-t.height/2-30,this.addChild(t),this.closeContain.graphics.beginFill(0),this.closeContain.alpha=0,this.closeContain.graphics.drawRect(415,495,50,50),this.closeContain.graphics.endFill(),this.addChild(this.closeContain)},t}(egret.Sprite);egret.registerClass(GameRuleView,"GameRuleView");var GameView=function(e){function t(){e.call(this),this.speed=2,this.radius=143,this.degree=0,this.times=0,this.money=0,this.textMoney=new egret.TextField,this.shp1=new egret.Shape,this.gameViewBg=new egret.Bitmap,this.addOne=new egret.TextField,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.gameViewBg.texture=RES.getRes("gameViewBg"),this.gameViewBg.width=450,this.gameViewBg.height=500,this.gameViewBg.x=this.stage.stageWidth/2-this.gameViewBg.width/2,this.gameViewBg.y=this.stage.stageHeight/2-this.gameViewBg.height/2,this.addChild(this.gameViewBg);var t=new egret.TextField;t.text="累计金额",t.size=25,t.fontFamily="黑体",t.x=this.stage.stageWidth-140,t.y=70,this.addChild(t),this.addOne.text="+1",this.addOne.size=50,this.addOne.textColor=13699343,this.addOne.bold=!0,this.addOne.fontFamily="黑体",this.addOne.x=this.stage.stageWidth/2-30,this.addOne.y=240,this.addOne.alpha=0,this.addChild(this.addOne),this.createMoney(),this.monkeyRing=new egret.Bitmap,this.monkeyRing.texture=RES.getRes("monkeyring"),this.monkeyRing.width=260,this.monkeyRing.height=140,this.monkeyRing.anchorOffsetX=130,this.monkeyRing.anchorOffsetY=70,this.monkeyRing.x=this.stage.stageWidth/2,this.monkeyRing.y=this.stage.stageHeight/2-27,this.addChild(this.monkeyRing),this.monkeyRing.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandle,this),this.createCo(),egret.localStorage.setItem("money","0"),egret.localStorage.setItem("times","0")},s.enterFrameHandle=function(){this.monkeyRing.rotation+=this.speed},s.createCo=function(){this.shp=new egret.Shape,this.centerX=this.stage.stageWidth/2,this.centerY=this.stage.stageHeight/2-27,this.degree=360*Math.random(),this.co=new egret.Bitmap,this.co.texture=RES.getRes("co"),this.co.width=65,this.co.height=30;var e=egret.Point.polar(this.radius,this.degree*Math.PI/180);this.co.x=this.centerX+e.x,this.co.y=this.centerY+e.y,this.co.rotation=this.degree+10,this.creatept1(),this.addChild(this.co)},s.creatept1=function(){var e=egret.Point.polar(this.radius,(this.degree+10)*Math.PI/180);this.shp.graphics.beginFill(251658240),this.shp.alpha=0,this.shp.graphics.drawCircle(this.centerX+e.x,this.centerY+e.y,15),this.shp.graphics.endFill(),this.shp.width=140,this.shp.height=140,this.addChild(this.shp)},s.creatept2=function(){var e=egret.Point.polar(135,(this.monkeyRing.rotation+25)*Math.PI/180),t={x:this.centerX+e.x,y:this.centerY+e.y};return t},s.createMoney=function(){this.textMoney.text="¥"+this.money,this.textMoney.size=30,this.textMoney.bold=!0,this.textMoney.fontFamily="黑体",this.textMoney.x=this.stage.stageWidth-120,this.textMoney.y=100,this.addChild(this.textMoney)},t}(egret.Sprite);egret.registerClass(GameView,"GameView");var WxShare=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.loadScript("http://res.wx.qq.com/open/js/jweixin-1.0.0.js",function(){}.bind(this))},s.loadScript=function(e,t){var i=document.createElement("script");i.type="text/javascript",i.src=e,i.readyState?i.onreadystatechange=function(){("loaded"==i.readyState||"complete"==i.readyState)&&(i.onreadystatechange=null,t())}:i.onload=function(){t()},document.body.appendChild(i)},s.jsApiShare=function(e,t,i,s){},s.WXshare=function(e,t,i,s){},t}(egret.Sprite);egret.registerClass(WxShare,"WxShare");